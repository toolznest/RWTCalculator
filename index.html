
<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RWT Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
            color: #333;
        }
        h2 {
            text-align: center;
            color: #0056b3;
        }
        textarea, input, button {
            font-size: 14px;
            margin: 5px 0;
        }
        #pasteArea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            background-color: #0056b3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #004085;
        }
        #outputTable, .summaryTable {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
            background-color: white;
        }
        #outputTable td, #outputTable th, .summaryTable td, .summaryTable th {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        #outputTable th, .summaryTable th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        #orderCounts, #summary, #liveUsers {
            margin-top: 20px;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        #timeFilter {
            margin-top: 10px;
        }
        #credit {
            margin-top: 20px;
            text-align: center;
            font-style: italic;
            color: #888;
        }
        .live-users-banner {
            margin: 10px 0;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            font-size: 18px;
            text-align: center;
            color: #0056b3;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h2>"What gets measured gets done."</h2>
    <textarea id="pasteArea" placeholder="Paste HTML code here..."></textarea><br>
    <button onclick="decodeTable()">Decode</button>

    <div id="timeFilter">
        <label for="startTime">Start Time:</label>
        <input type="time" id="startTime">
        <label for="endTime">End Time:</label>
        <input type="time" id="endTime">
        <button onclick="filterByTime()">Filter</button>
    </div>

    <div class="live-users-banner" id="liveUsers">Total Live Users: 0</div>

    <div id="tableContainer"></div>
    <div id="orderCounts"></div>
    <div id="summary"></div>

    <div id="credit">Designed and developed by Praveen Kumar B J</div>

    <script>
        let originalTableRows = [];
        let liveUsers = 0;

        function calculateTimeDifference(arrivedTime, pickedUpTime) {
            arrivedTime = arrivedTime.trim();
            pickedUpTime = pickedUpTime.trim();

            if (arrivedTime === "-" || pickedUpTime === "-") {
                return { minutes: 0, seconds: 0, totalMinutes: 0 };
            }

            const arrived = new Date(`1970-01-01T${arrivedTime}`);
            const pickedUp = new Date(`1970-01-01T${pickedUpTime}`);

            if (isNaN(arrived.getTime()) || isNaN(pickedUp.getTime())) {
                return { minutes: 0, seconds: 0, totalMinutes: 0 };
            }

            const difference = pickedUp - arrived;
            const minutes = Math.floor(difference / 60000);
            const seconds = Math.floor((difference % 60000) / 1000);
            const totalMinutes = minutes + seconds / 60;

            return { minutes, seconds, totalMinutes };
        }

        function decodeTable() {
            const tableCode = document.getElementById('pasteArea').value;

            const parser = new DOMParser();
            const doc = parser.parseFromString(`<table>${tableCode}</table>`, 'text/html');

            originalTableRows = Array.from(doc.querySelectorAll('tr'));

            displayTable(originalTableRows);
        }

        function displayTable(tableRows) {
            let swiggyCount = 0, zomatoCount = 0;

            if (tableRows.length > 0) {
                const outputTable = document.createElement('table');
                outputTable.id = 'outputTable';

                const headerRow = document.createElement('tr');
                ['Index', 'Image', 'Order ID', 'Ordered Time', 'Rider Assigned', 'Rider Arrived', 'Picked Up Time', 'Rider Wait Time'].forEach(headerText => {
                    const th = document.createElement('th');
                    th.textContent = headerText;
                    headerRow.appendChild(th);
                });
                outputTable.appendChild(headerRow);

                tableRows.forEach((row, index) => {
                    const newRow = document.createElement('tr');
                    const cells = row.querySelectorAll('td');
                    let platform = '';

                    cells.forEach((td, idx) => {
                        const newCell = document.createElement('td');

                        if (idx === 1) {
                            const img = td.querySelector('img');
                            newCell.appendChild(img.cloneNode(true));

                            const imgSrc = img.src;
                            if (imgSrc.includes('swiggy')) {
                                swiggyCount++;
                                platform = 'Swiggy';
                            } else if (imgSrc.includes('zomato')) {
                                zomatoCount++;
                                platform = 'Zomato';
                            }
                        } else {
                            newCell.innerHTML = td.innerHTML;
                        }
                        newRow.appendChild(newCell);
                    });

                    outputTable.appendChild(newRow);
                });

                const tableContainer = document.getElementById('tableContainer');
                tableContainer.innerHTML = '';
                tableContainer.appendChild(outputTable);

                updateLiveUsers(swiggyCount + zomatoCount);
            } else {
                alert('No valid table data found');
            }
        }

        function updateLiveUsers(count) {
            liveUsers = count;
            document.getElementById('liveUsers').textContent = `Total Live Users: ${liveUsers}`;
        }

        function filterByTime() {
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;

            if (!startTime || !endTime) {
                alert('Please enter both start and end times');
                return;
            }

            const filteredRows = originalTableRows.filter(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 3) {
                    const orderedTime = cells[3].textContent.trim();
                    return isTimeInRange(orderedTime, startTime, endTime);
                }
                return false;
            });

            displayTable(filteredRows);
        }

        function isTimeInRange(time, start, end) {
            const orderTime = new Date(`1970-01-01T${time}`);
            const startTime = new Date(`1970-01-01T${start}`);
            const endTime = new Date(`1970-01-01T${end}`);

            if (endTime < startTime) {
                endTime.setDate(endTime.getDate() + 1);
            }

            return orderTime >= startTime && orderTime <= endTime;
        }
    </script>

</body>
</html>
